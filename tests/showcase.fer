// Showcase: All Map Features Working Together

// 1. Basic map types
type StringToInt map[str]i32;
type IntToString map[i32]str;

// 2. Nested map types
type NestedMap map[str]map[i32]str;

// 3. Struct with map field
type Person struct {
    .name: str,
    .age: i32,
};

type Company struct {
    .name: str,
    .employees: map[str]Person,
};

// 4. Map type alias with struct values
type PersonRegistry map[str]Person;

// ============================================
// USAGE EXAMPLES
// ============================================

// Basic map literal with named type
let scores := StringToInt{
    "alice" => 95,
    "bob" => 87,
    "charlie" => 92
};

// Map literal with inline type
let lookup := map[i32]str{
    1 => "one",
    2 => "two",
    3 => "three"
};

// Empty map
let empty := map[str]i32{};

// Nested map
let nested := NestedMap{
    "level1" => map[i32]str{
        1 => "value1",
        2 => "value2"
    },
    "level2" => map[i32]str{
        10 => "value10"
    }
};

// Struct with map field
let company := Company{
    .name = "TechCorp",
    .employees = map[str]Person{
        "emp001" => Person{.name = "Alice", .age = 30},
        "emp002" => Person{.name = "Bob", .age = 25},
        "emp003" => Person{.name = "Charlie", .age = 35}
    }
};

// Map of structs using type alias
let registry := PersonRegistry{
    "alice" => Person{.name = "Alice Johnson", .age = 30},
    "bob" => Person{.name = "Bob Smith", .age = 25}
};

// ============================================
// MAPS IN CONDITIONS (NO PARENTHESES!)
// ============================================

// Simple map comparison
if scores == StringToInt{"alice" => 95, "bob" => 87, "charlie" => 92} {
    let match1 := 1;
}

// Inline map type in condition
if lookup == map[i32]str{1 => "one", 2 => "two", 3 => "three"} {
    let match2 := 1;
}

// Empty map in condition
if empty == map[str]i32{} {
    let match3 := 1;
}

// Nested map in condition
if nested == NestedMap{
    "level1" => map[i32]str{1 => "value1", 2 => "value2"},
    "level2" => map[i32]str{10 => "value10"}
} {
    let match4 := 1;
}

// Struct with map in condition
if company == Company{
    .name = "TechCorp",
    .employees = map[str]Person{
        "emp001" => Person{.name = "Alice", .age = 30},
        "emp002" => Person{.name = "Bob", .age = 25},
        "emp003" => Person{.name = "Charlie", .age = 35}
    }
} {
    let match5 := 1;
}

// Map of structs in condition
if registry == PersonRegistry{
    "alice" => Person{.name = "Alice Johnson", .age = 30},
    "bob" => Person{.name = "Bob Smith", .age = 25}
} {
    let match6 := 1;
}

// ============================================
// COMPLEX NESTING SHOWCASE
// ============================================

type Organization struct {
    .name: str,
    .departments: map[str]Department,
};

type Department struct {
    .name: str,
    .teams: map[str]Team,
};

type Team struct {
    .lead: Person,
    .members: map[str]Person,
};

// Triple-nested: Struct -> Map -> Struct -> Map -> Struct -> Map -> Struct
let org := Organization{
    .name = "MegaCorp",
    .departments = map[str]Department{
        "engineering" => Department{
            .name = "Engineering",
            .teams = map[str]Team{
                "backend" => Team{
                    .lead = Person{.name = "Alice", .age = 35},
                    .members = map[str]Person{
                        "dev1" => Person{.name = "Bob", .age = 28},
                        "dev2" => Person{.name = "Charlie", .age = 26}
                    }
                },
                "frontend" => Team{
                    .lead = Person{.name = "Diana", .age = 32},
                    .members = map[str]Person{
                        "dev3" => Person{.name = "Eve", .age = 27},
                        "dev4" => Person{.name = "Frank", .age = 29}
                    }
                }
            }
        },
        "sales" => Department{
            .name = "Sales",
            .teams = map[str]Team{
                "enterprise" => Team{
                    .lead = Person{.name = "Grace", .age = 40},
                    .members = map[str]Person{
                        "rep1" => Person{.name = "Henry", .age = 31}
                    }
                }
            }
        }
    }
};

// Even this monster works in a condition!
if org == Organization{
    .name = "MegaCorp",
    .departments = map[str]Department{
        "engineering" => Department{
            .name = "Engineering",
            .teams = map[str]Team{
                "backend" => Team{
                    .lead = Person{.name = "Alice", .age = 35},
                    .members = map[str]Person{
                        "dev1" => Person{.name = "Bob", .age = 28},
                        "dev2" => Person{.name = "Charlie", .age = 26}
                    }
                },
                "frontend" => Team{
                    .lead = Person{.name = "Diana", .age = 32},
                    .members = map[str]Person{
                        "dev3" => Person{.name = "Eve", .age = 27},
                        "dev4" => Person{.name = "Frank", .age = 29}
                    }
                }
            }
        },
        "sales" => Department{
            .name = "Sales",
            .teams = map[str]Team{
                "enterprise" => Team{
                    .lead = Person{.name = "Grace", .age = 40},
                    .members = map[str]Person{
                        "rep1" => Person{.name = "Henry", .age = 31}
                    }
                }
            }
        }
    }
} {
    let ultimate_test_passed := 1;
}
